Języki asemblerowe oferują programistom niski poziom kontroli nad sprzętem, umożliwiając bezpośrednie operowanie na rejestrach procesora i pamięci. Procedury i makrodefinicje są dwoma mechanizmami stosowanymi w asemblerze, które ułatwiają organizację kodu i jego czytelność. Mimo, że oba te podejścia mają pewne podobieństwa, różnią się znacząco względem działania, wykorzystania i wpływu  na wydajność programu.

##### Procedura
```asm
SUM PROC
    ; Zakładamy, że na stosie są dwa argumenty: 
    ; [BP+4] to pierwszy argument (np. liczba 1)
    ; [BP+6] to drugi argument (np. liczba 2)
    MOV AX, [BP+4]  ; Pobierz pierwszy argument
    ADD AX, [BP+6]  ; Dodaj drugi argument do AX
    RET             ; Powrót z procedury
SUM ENDP

; Wywołanie procedury
PUSH 10            ; Przekazanie pierwszego argumentu (10)
PUSH 20            ; Przekazanie drugiego argumentu (20)
CALL SUM           ; Wywołanie procedury
```

##### Makro
```asm
SUM MACRO ARG1, ARG2
    MOV AX, ARG1
    ADD AX, ARG2
ENDM

SUM 10, 20 ; Rozwinięcie makra
```
### Podobieństwa

1. Cel: Zarówno procedury, jak i makrodefinicje służą do modularnego projektowania kodu, umożliwiając jego wielokrotne wykorzystanie, co poprawia czytelność i organizację programu.
   
2. Struktura: Obie formy mają zdefiniowaną strukturę - nagłówek i ciało. W procedurach ciało zawiera instrukcje wykonywalne, a w makrodefinicjach szablon kodu, który jest rozwijany w miejscu wywołania.
   
3. Czytelność: Oba te mechanizmy pozwalają na unikanie wielokrotnego pisania tego samego kodu, co ułatwia utrzymanie programu.
   
4. Parametryzacja: Zarówno procedury, jak i makrodefinicje mogą przyjmować argumenty, co zwiększa ich elastyczność. 

### Różnice

| Cecha                 | Procedura                                                                                                                                                                                                                                                                                                                                          | Makrodefinicja                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| --------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Sposób działania      | Fragment kodu, który jest<br>wywoływany w określonym<br>miejscu programu za pomocą<br>instrukcji wywołania (CALL).<br>Powrót następuje dzięki RET.                                                                                                                                                                                                 | Makrodefinicje to szablon kodu,<br>który jest rozwijany w miejscu<br>wywołania w trakcie kompilacji,<br>generując odpowiedni kod<br>maszynowy.                                                                                                                                                                                                                                                                                                                                                           |
| Czas realizacji       | Procedura jest wolniejsza od<br>makra.                                                                                                                                                                                                                                                                                                             | Makro jest szybsze niż<br>procedura.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Wpływ na kod wynikowy | Procedura generuje tylko<br>jedno wystąpienie kodu w<br>pamięci, a każda instrukcja<br>wywołania odnosi się do tego<br>samego fragmentu.                                                                                                                                                                                                           | Każde użycie makrodefinicji<br>generuje kopię kodu w miejscu<br>jej rozwinięcia, co może pro-<br>wadzić do znacznego zwię-<br>kszenia rozmiaru programu.                                                                                                                                                                                                                                                                                                                                                 |
| Koszt wykonania       | Wywołanie procedury wiąże<br>się z narzutem związanym z<br>przekazywaniem argumentów<br>i obsługą stosu (np. PUSH,<br>POP, CALL, RET).                                                                                                                                                                                                             | Brak narzutu czasowego w<br>czasie działania programu,<br>ponieważ makro jest rozwijane<br>jako kod in-line, ale kosztuje<br>więcej miejsca w pamięci.                                                                                                                                                                                                                                                                                                                                                   |
| Elastyczność          | Procedury mogą zawierać<br>bardziej złożone operacje<br>i są lepsze do implementowania<br>skomplikowanych algorytmów.                                                                                                                                                                                                                              | Makrodefinicje są prostsze i<br>bardziej efektywne w przypadku<br>powtarzalnych, krótkich frag-<br>mentów kodu.                                                                                                                                                                                                                                                                                                                                                                                          |
| Debugowanie           | Procedury są łatwiejsze do<br>debugowania, ponieważ istnieje<br>jeden fragment kodu, którego<br>wykonanie można śledzić krok<br>po kroku.                                                                                                                                                                                                          | Kod makro rozwijany w<br>miejscu wywołania może być<br>trudniejszy do debugowania,<br>szczególnie gdy rozwinięcie<br>zajmuje dużo miejsca w<br>programie                                                                                                                                                                                                                                                                                                                                                 |
| Zastosowanie          | Procedury są używane gdzie<br>ważne jest ograniczenie<br>rozmiaru kodu i modularność<br>programu.                                                                                                                                                                                                                                                  | Makrodefinicje są stosowane,<br>gdy wydajność jest kluczowa,<br>a narzut czasowy wywołania<br>procedury jest niepożądany.<br>Również stosowane w<br>przypadku krótkich fragmentów<br>logiki.                                                                                                                                                                                                                                                                                                             |
| Bezpieczeństwo typów  | Procedury mają formalny inter-<br>fejs przekazywania argumentów<br>(np. przez stos, lub rejestry),<br>co wymusza zgodność typów<br>na etapie wywołania. Każde<br>naruszenie (np. przekazanie<br>8-bitowej wartości, tam gdzie<br>oczekiwana jest 16-bitowa)<br>zostaje wykryte przez asembler<br>podczas kompilacji. (Analiza<br>kodu źródłowego). | Makrodefinicje traktują argu-<br>menty jako zwykły tekst wsta-<br>wiany do kodu wynikowego,<br>bez weryfikacji typów w<br>momencie wywołania. Jeśli<br>argumenty mają niewłaściwy<br>rozmiar lub typ, błędy są wy-<br>krywane podczas kompilacji<br>rozwiniętego kodu co może<br>prowadzić do trudnych do<br>zidentyfikowania problemów.<br>Brak centralnego punktu<br>kontroli sprawia, że poprawienie<br>błędów może wymagać analizy<br>każdego miejsca wywołania<br>makra. (Analiza kodu wynikowego). |

Jak odkryliśmy, makra i procedury są ważnymi narzędziami w programowaniu, ale każde z nich ma inną funkcję. Makra doskonale nadają się do przechowywania pojedynczych i wielokrotnych linii kodu, które mają być wykonywane dość często i dla których istotna jest oszczędność czasu, natomiast procedury najlepiej sprawdzają się w przypadku dłuższego kodu, który można podzielić na segmenty dla łatwiejszej organizacji i który wymaga sprawdzania typu. Znajomość rozróżnień i czasów użycia każdego z nich pomoże w stworzeniu czystszego i łatwiejszego w zarządzaniu kodu.